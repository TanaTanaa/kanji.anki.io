
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã«ã»ã‚“ã”ã‚¯ã‚¤ã‚º</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    textarea, input, button { margin: 5px; font-size: 16px; }
    .card { border: 2px solid #ccc; border-radius: 12px; padding: 20px; margin:20px auto; width:80%; max-width:400px; font-size:24px; }
    .word-list { margin-top:20px; text-align:left; max-width:500px; margin:auto; font-size:18px; }
    .hide { display: none; }
  </style>
</head>
<body>
  <h1>ã«ã»ã‚“ã”ã‚¯ã‚¤ã‚ºï¼ˆè‡ªå·±åˆ¤å®šå¼ï¼‰</h1>

  <div id="edit-area">
    <textarea id="bulkInput" rows="6" cols="50" placeholder="æ¼¢å­—,ã‚ˆã¿ã‚’æ”¹è¡Œã§å…¥åŠ›&#10;ä¾‹ï¼‰å·,ã‹ã‚"></textarea><br>
    <button onclick="addWords()">å˜èªã‚’è¿½åŠ </button>
    <button onclick="shareURL()">å…±æœ‰ç”¨URLã‚’ç”Ÿæˆ</button><br>
    <input type="text" id="shareURL" readonly style="width:80%" onclick="this.select()" placeholder="ã“ã“ã«URLãŒè¡¨ç¤ºã•ã‚Œã¾ã™">
    <h2>ğŸ“š å˜èªãƒªã‚¹ãƒˆ</h2>
    <ul id="vocabList" class="word-list"></ul>
  </div>

  <div id="quizCard" class="card hide">
    <div id="question"></div>
    <div id="progress" style="margin:10px 0; font-size:18px; color:#555;"></div>
    <button onclick="showAnswer()">ã“ãŸãˆã‚’ã¿ã‚‹</button>
    <div id="answer" style="display:none; margin-top:10px; font-size:22px; color:#007700;"></div>
    <button onclick="markCorrect()">â—‹ æ­£è§£</button>
    <button onclick="markWrong()">Ã— ã¾ã¡ãŒã„</button>
  </div>

  <div id="result" style="margin-top:20px; font-size:18px;"></div>
  <button onclick="startQuiz()">ã‚¯ã‚¤ã‚ºã‚’ã¯ã˜ã‚ã‚‹</button>
  <button onclick="startRetest()">ã¾ã¡ãŒãˆãŸå˜èªã§å†ãƒ†ã‚¹ãƒˆ</button>

<script>
  let vocab = [];
  let currentIndex = 0, usedIndices = [], wrongIndices = [];

  function addWords(){
    const lines = document.getElementById("bulkInput").value.trim().split("\n");
    lines.forEach(line=>{
      let [kanji, reading] = line.split(",");
      if(kanji && reading){
        vocab.push({ kanji:kanji.trim(), reading:reading.trim() });
      }
    });
    renderVocabList();
    alert("å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸ");
  }
  function renderVocabList(){
    const ul = document.getElementById("vocabList"); ul.innerHTML = "";
    vocab.forEach((w,i)=>{
      const li = document.createElement("li");
      li.textContent = `${w.kanji} - ${w.reading} `;
      const del = document.createElement("button");
      del.textContent="å‰Šé™¤"; del.onclick=()=>{
        vocab.splice(i,1);
        renderVocabList();
      };
      li.appendChild(del);
      ul.appendChild(li);
    });
  }

  function startQuiz(){
    if(vocab.length===0) return alert("å˜èªãŒã‚ã‚Šã¾ã›ã‚“");
    usedIndices = []; wrongIndices = []; document.getElementById("result").textContent="";
    document.getElementById("quizCard").classList.remove("hide");
    nextQuestion();
  }
  function nextQuestion(){
    if(usedIndices.length>=vocab.length){
      document.getElementById("result").textContent = `ãŠã‚ã‚Šï¼ (${vocab.length-wrongIndices.length} æ­£è§£ï¼${vocab.length})`;
      document.getElementById("quizCard").classList.add("hide");
      document.getElementById("progress").textContent="";
      return;
    }
    let idx;
    do{ idx = Math.floor(Math.random()*vocab.length); }while(usedIndices.includes(idx));
    currentIndex=idx; usedIndices.push(idx);
    const w = vocab[idx];
    document.getElementById("question").textContent = w.kanji;
    document.getElementById("answer").style.display="none";
    document.getElementById("answer").textContent = w.reading;
    document.getElementById("progress").textContent = `å•é¡Œ ${usedIndices.length} / ${vocab.length}`;
  }
  function showAnswer(){ document.getElementById("answer").style.display="block"; }
  function markCorrect(){ nextQuestion(); }
  function markWrong(){ if(!wrongIndices.includes(currentIndex)) wrongIndices.push(currentIndex); nextQuestion(); }
  function startRetest(){
    if(wrongIndices.length===0) return alert("ã¾ã¡ãŒãˆãŸå˜èªãŒã‚ã‚Šã¾ã›ã‚“");
    vocab = wrongIndices.map(i=>vocab[i]);
    usedIndices = []; wrongIndices = [];
    document.getElementById("result").textContent = "å†ãƒ†ã‚¹ãƒˆé–‹å§‹";
    document.getElementById("quizCard").classList.remove("hide");
    nextQuestion();
  }

  function shareURL(){
    if(vocab.length===0)return alert("å˜èªã‚’è¿½åŠ ã—ã¦ãã ã•ã„");
    const json = JSON.stringify(vocab);
    const encoded = encodeURIComponent(btoa(unescape(encodeURIComponent(json))));
    const url = `${location.origin}${location.pathname}?data=${encoded}`;
    const input = document.getElementById("shareURL");
    input.value = url; input.select();
    navigator.clipboard.writeText(url);
    alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
  }

  function loadFromURL(){
    const p = new URLSearchParams(location.search).get("data");
    if(p){
      try {
        const decoded = decodeURIComponent(escape(atob(decodeURIComponent(p))));
        vocab = JSON.parse(decoded);
        document.getElementById("edit-area").classList.add("hide");
        currentIndex = 0; usedIndices=[]; wrongIndices=[];
        document.getElementById("quizCard").classList.remove("hide");
        nextQuestion();
      } catch {
        alert("URLã®å†…å®¹ãŒå£Šã‚Œã¦ã„ã¾ã™");
      }
    }
  }

  window.onload = loadFromURL;
</script>
</body>
</html>
