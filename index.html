<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>日本語クイズ（漢字編）</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    .card { border: 2px solid #ccc; border-radius: 12px; padding: 20px; margin: 20px auto; max-width: 400px; }
    .buttons button { margin: 10px; padding: 10px 20px; }
    textarea { width: 100%; height: 80px; }
  </style>
</head>
<body>
  <h1>日本語クイズ（漢字編）</h1>

  <div>
    <label for="input">単語リストを貼り付け（漢字,よみがな 形式）：</label><br />
    <textarea id="input" placeholder="例：山,やま\n川,かわ\n空,そら"></textarea><br />
    <button onclick="loadWords()">読み込み</button>
    <button onclick="generateShareLink()">共有用リンク作成</button>
  </div>

  <div id="quiz" style="display:none;">
    <div class="card">
      <div id="question"></div>
      <div class="buttons">
        <button onclick="showAnswer()">答えを表示</button>
        <button onclick="next()">次へ</button>
      </div>
      <div id="answer" style="display:none;"></div>
    </div>
    <div id="progress"></div>
  </div>

  <div id="share" style="margin-top:20px;"></div>

  <script>
    let words = [];
    let current = 0;

    function loadWords() {
      const text = document.getElementById("input").value;
      words = text
        .split("\n")
        .map(line => line.split(","))
        .filter(pair => pair.length === 2)
        .map(([kanji, reading]) => ({ kanji: kanji.trim(), reading: reading.trim() }));
      current = 0;
      if (words.length > 0) {
        document.getElementById("quiz").style.display = "block";
        next();
      }
    }

    function showAnswer() {
      document.getElementById("answer").style.display = "block";
    }

    function next() {
      if (current >= words.length) {
        alert("おしまい！");
        return;
      }
      const word = words[current];
      document.getElementById("question").textContent = `この漢字の読み方は？： ${word.kanji}`;
      document.getElementById("answer").textContent = `よみがな： ${word.reading}`;
      document.getElementById("answer").style.display = "none";
      document.getElementById("progress").textContent = `問題 ${current + 1} / ${words.length}`;
      current++;
    }

    function generateShareLink() {
      if (words.length === 0) {
        alert("単語リストを読み込んでください");
        return;
      }
      const json = JSON.stringify(words);
      const encoded = btoa(unescape(encodeURIComponent(json)));
      const url = `${location.origin}${location.pathname}?data=${encoded}`;
      const link = `<p>共有URL：<a href="${url}" target="_blank">${url}</a></p>`;
      document.getElementById("share").innerHTML = link;
    }

    function loadFromUrl() {
      const params = new URLSearchParams(location.search);
      const data = params.get("data");
      if (data) {
        try {
          const decoded = decodeURIComponent(escape(atob(data)));
          words = JSON.parse(decoded);
          current = 0;
          document.getElementById("quiz").style.display = "block";
          document.getElementById("input").style.display = "none";
          next();
        } catch (e) {
          console.error("読み込み失敗", e);
        }
      }
    }

    window.onload = loadFromUrl;
  </script>
</body>
</html>
