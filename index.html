<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>タイ語単語テスト共有</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    textarea, input, button { width: 100%; margin-top: 10px; padding: 10px; font-size: 1rem; }
    .card { border: 1px solid #ccc; padding: 20px; margin-top: 20px; border-radius: 8px; }
    .hide { display: none; }
  </style>
</head>
<body>
  <h1>タイ語単語テスト</h1>

  <!-- 編集エリア（作成者だけが見える） -->
  <div id="edit-area">
    <h3>単語を入力（形式: 漢字,読み）</h3>
    <textarea id="word-input" rows="8" placeholder="水,みず\n火,ひ"></textarea>
    <button onclick="generateShareURL()">URLを生成・コピー</button>
    <input id="share-url" readonly />
  </div>

  <!-- テストエリア -->
  <div id="quiz-area" class="hide">
    <div class="card">
      <div id="quiz-question"></div>
      <button onclick="showAnswer()">こたえをみる</button>
      <div id="quiz-answer" class="hide"></div>
      <button onclick="nextWord()">つぎへ</button>
    </div>
  </div>

  <script>
    let wordList = [];
    let currentIndex = 0;

    // ----------------------------
    // URLからデータを読み込む
    // ----------------------------
    function loadFromURL() {
      const params = new URLSearchParams(location.search);
      const data = params.get('data');
      if (!data) return null;
      try {
        const json = JSON.parse(decodeURIComponent(escape(atob(decodeURIComponent(data)))));
        return json;
      } catch (e) {
        alert("URLの内容が壊れています。");
        return null;
      }
    }

    // ----------------------------
    // URLを生成・表示・コピー
    // ----------------------------
    function generateShareURL() {
      const raw = document.getElementById("word-input").value.trim();
      const lines = raw.split("\n").filter(l => l.includes(","));
      const words = lines.map(line => {
        const [kanji, reading] = line.split(",");
        return { kanji: kanji.trim(), reading: reading.trim() };
      });

      const json = JSON.stringify(words);
      const encoded = encodeURIComponent(btoa(unescape(encodeURIComponent(json))));
      const url = `${location.origin}${location.pathname}?data=${encoded}`;
      const input = document.getElementById("share-url");
      input.value = url;
      input.select();
      document.execCommand("copy");
      alert("URLをコピーしました！");
    }

    // ----------------------------
    // テスト表示
    // ----------------------------
    function startQuiz() {
      if (!wordList || wordList.length === 0) return;
      document.getElementById("edit-area").classList.add("hide");
      document.getElementById("quiz-area").classList.remove("hide");
      currentIndex = 0;
      showQuiz();
    }

    function showQuiz() {
      const word = wordList[currentIndex];
      document.getElementById("quiz-question").textContent = `この読み方は？ → ${word.kanji}`;
      document.getElementById("quiz-answer").textContent = `こたえ：${word.reading}`;
      document.getElementById("quiz-answer").classList.add("hide");
    }

    function showAnswer() {
      document.getElementById("quiz-answer").classList.remove("hide");
    }

    function nextWord() {
      currentIndex = (currentIndex + 1) % wordList.length;
      showQuiz();
    }

    // ----------------------------
    // ページ読み込み時の初期化
    // ----------------------------
    window.onload = () => {
      const data = loadFromURL();
      if (data) {
        wordList = data;
        startQuiz();
      }
    };
  </script>
</body>
</html>

